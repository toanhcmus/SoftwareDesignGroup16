<!DOCTYPE html>
<html>

<head>
    <title>HappyGroup</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-KK94CHFLLe+nY2dmCWGMq91rCGa5gtU4mk92HdvYe+M/SXH301p5ILy+dN9+nJOZ" crossorigin="anonymous">
    <style>
        .card {
            margin-bottom: 20px;
        }

        .filter-section {
            margin-bottom: 30px;
        }

        .card-img-top {
            height: 200px;
            object-fit: cover;
        }
    </style>
</head>

<body>
    <div class="container my-4">
        <h1 class="text-center mb-4">HappyGroup</h1>

        <div class="filter-section">
            <div class="row mb-3">
                <div class="col-md-4">
                    <label for="select-option" class="form-label">Chọn option:</label>
                    <select id="select-option" class="form-select">
                        <option value="">Chọn truyện</option>
                        <option value="a">truyenfull.vn</option>
                        <option value="b">b</option>
                        <option value="c">c</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <form method="GET">
                        <div class="input-group">
                            <input type="text" name="keyword" class="form-control" placeholder="Tìm kiếm...">
                            <button class="btn btn-primary" type="submit">Tìm kiếm</button>
                        </div>
                    </form>
                    <button type="button" class="btn btn-success btn-lg" onclick="saveStates()">Nguyễn Song Toàn chạy DL nhanh lên</button>
                </div>

                <div class="col-md-4">

                    <table class="table">
                        <tbody>
                            <tr>
                                <td>Mức độ ưu tiên</td>
                                <td><button id="reset-chose-link">Thiết lập lại</button>
                                </td>
                            </tr>
                            <tr>
                                <td>1</td>
                                <td>
                                    <div>
                                        <select id="select-option-1" class="choose-link"
                                            onchange="updateSelectOptions('select-option-1')">
                                            <option value="" selected hidden>Chọn truyện</option>
                                            <option value="truyenfull.vn">truyenfull.vn</option>
                                            <option value="tangthuvien.com">tangthuvien.com</option>
                                            <option value="metruyen.vn">metruyen.vn</option>>
                                        </select>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>2</td>
                                <td>
                                    <div>
                                        <select id="select-option-2" class="choose-link"
                                            onchange="updateSelectOptions('select-option-2')">
                                            <option value="" selected hidden>Chọn truyện</option>
                                            <option value="truyenfull.vn">truyenfull.vn</option>
                                            <option value="tangthuvien.com">tangthuvien.com</option>
                                            <option value="metruyen.vn">metruyen.vn</option>
                                        </select>
                                    </div>
                                </td>
                            </tr>
                            <tr>
                                <td>3</td>
                                <td>
                                    <div>
                                        <select id="select-option-3" class="choose-link"
                                            onchange="updateSelectOptions('select-option-3')">
                                            <option value="" selected hidden>Chọn truyện</option>
                                            <option value="truyenfull.vn">truyenfull.vn</option>
                                            <option value="tangthuvien.com">tangthuvien.com</option>
                                            <option value="metruyen.vn">metruyen.vn</option>
                                        </select>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <%if (isSearched){ %>

            <% if (novels.length>0) { %>
                <div id="container-list-novels">
                    <h2 class="text-center mb-4">Danh sách truyện</h2>
                    <div class="row row-cols-1 row-cols-md-4 g-4">
                        <% for(var i=0; i<novels.length; i++) {%>
                            <div class="col">
                                <div class="card">
                                    <img src="<%= novels[i].cover %>" class="card-img-top" alt="Card Image">
                                    <div class="card-body">
                                        <h5 class="card-title">
                                            <%= novels[i].title %>
                                        </h5>
                                        <p class="card-text"> <%= novels[i].author %></p>
                                        <p class="card-text"> <%= novels[i].origin %></p>
                                    </div>
                                </div>
                            </div>
                        <% } %>
                    </div>
    
                                         <% }
                 else { 
                %> <h2>Từ khóa tìm kiếm không hợp lệ</h2> <%} 
             %>

           
        <%} else {
            %>
            <h2>Nhập từ khóa để tìm kiếm</h2>
            <%
        }
        %>





            </div>

            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-ENjdO4Dr2bkBIFxQpIdKSsYG1g3PHPWlDxLgmNkwlghG56Yd7whQYGHIgKmZoZnl"
                crossorigin="anonymous"></script>
            <script>
                var mLink = ["truyenfull.vn", "metruyen.vn", "tangthuvien.com"];
                document.querySelector("#reset-chose-link").onclick = function () {
                    console.log("abc")
                    mLink = ["truyenfull.vn", "metruyen.vn", "tangthuvien.com"];
                    var selects = document.querySelectorAll(".choose-link");
                    for (var i = 0; i < selects.length; i++) {
                        var select = selects[i];
                        select.innerHTML = ''
                        var newOption = document.createElement("option");
                        newOption.value = "";
                        newOption.text = "Chọn truyện";
                        select.add(newOption);
                        mLink.forEach(function (option) {
                            var newOption = document.createElement("option");
                            newOption.value = option;
                            newOption.text = option;
                            select.add(newOption);
                        });
                        select.disabled = false

                    }
                };

                function updateSelectOptions(selectedOptionId) {
                    // Lấy giá trị đã chọn từ select option
                    console.log("-------------------")
                    var selectedOptionElement = document.getElementById(selectedOptionId);

                    selectedOptionElement.disabled = true

                    // Loại bỏ truyện đã chọn khỏi mảng truyen
                    mLink = mLink.filter(function (option) {
                        return option !== selectedOptionElement.value;
                    });

                    // Cập nhật lại danh sách tùy chọn cho các ô chọn khác
                    var selects = document.querySelectorAll(".choose-link");

                    for (var i = 0; i < selects.length; i++) {
                        var select = selects[i];
                        if (select.id != selectedOptionId && select.value === "") {
                            console.log("a " + select.id)
                            select.innerHTML = ''
                            if (mLink.length == 1) {
                                select.disabled = true
                            }
                            if (mLink.length > 1) {
                                var newOption = document.createElement("option");
                                newOption.value = "";
                                newOption.text = "Chọn truyện";
                                select.add(newOption);
                            }
                            mLink.forEach(function (option) {
                                var newOption = document.createElement("option");
                                newOption.value = option;
                                newOption.text = option;
                                select.add(newOption);
                            });
                        }

                    }
                }
                async function saveStates(){
                    console.log('aaaaaaaaaa')
                    try {
                        const response = await fetch('/novel/saveStates', {
                            method: 'GET'
                        });
                        if (!response.ok) {
                            throw new Error('Network response was not ok');
                        }
                        const data = await response.json();
                        console.log('Success:', data);
                        if (data.redirect) {
                            window.location.href = data.redirect;
                        }
                    } catch (error) {
                        console.error('Error:', error);
                    }
                }
            </script>

</body>

</html>